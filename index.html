<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Email Drafter</title>
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            min-height: 100vh;
        }
        
        .container {
            max-width: 100%;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        h1 {
            color: #0078d4;
            font-size: 18px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #323130;
        }
        
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d1d1;
            border-radius: 4px;
            font-size: 14px;
            resize: vertical;
            box-sizing: border-box;
        }
        
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d1d1;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .btn-primary {
            background-color: #0078d4;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #106ebe;
        }
        
        .btn-secondary {
            background-color: #f3f2f1;
            color: #323130;
            border: 1px solid #d1d1d1;
        }
        
        .btn-secondary:hover {
            background-color: #e1dfdd;
        }
        
        .loading {
            display: none;
            text-align: center;
            color: #0078d4;
            margin: 10px 0;
        }
        
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #0078d4;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            color: #d13438;
            background-color: #fde7e9;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            display: none;
        }
        
        .success {
            color: #107c10;
            background-color: #dff6dd;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            display: none;
        }
        
        .preview {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }
        
        .preview h3 {
            margin-top: 0;
            color: #495057;
        }
        
        .api-key-section {
            background-color: #fff4e6;
            border: 1px solid #ffd60a;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .api-key-section h3 {
            margin-top: 0;
            color: #b45309;
        }
        
        input[type="password"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d1d1;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ¤– AI Email Drafter</h1>
        
        <div class="api-key-section">
            <h3>API Configuration</h3>
            <div class="form-group">
                <label for="apiKey">OpenAI API Key:</label>
                <input type="password" id="apiKey" placeholder="Enter your OpenAI API key">
            </div>
        </div>
        
        <div class="form-group">
            <label for="emailInput">Email Ideas/Draft:</label>
            <textarea id="emailInput" rows="4" placeholder="Enter your rough email ideas, key points, or draft here..."></textarea>
        </div>
        
        <div class="form-group">
            <label for="emailTone">Email Tone:</label>
            <select id="emailTone">
                <option value="professional">Professional</option>
                <option value="friendly">Friendly</option>
                <option value="formal">Formal</option>
                <option value="casual">Casual</option>
                <option value="persuasive">Persuasive</option>
            </select>
        </div>
        
        <div class="button-group">
            <button class="btn-primary" onclick="generateEmail()">Generate Email</button>
            <button class="btn-secondary" onclick="clearAll()">Clear</button>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            Generating email...
        </div>
        
        <div class="error" id="error"></div>
        <div class="success" id="success"></div>
        
        <div class="preview" id="preview">
            <h3>Generated Email:</h3>
            <div id="generatedContent"></div>
            <div class="button-group" style="margin-top: 15px;">
                <button class="btn-primary" onclick="insertToEmail()">Insert to Email</button>
                <button class="btn-secondary" onclick="copyToClipboard()">Copy to Clipboard</button>
            </div>
        </div>
    </div>

    <script>
        let generatedEmailContent = '';
        
        Office.onReady((info) => {
            if (info.host === Office.HostType.Outlook) {
                console.log('Outlook add-in loaded successfully');
            }
        });
        
        async function generateEmail() {
            const apiKey = document.getElementById('apiKey').value;
            const emailInput = document.getElementById('emailInput').value;
            const emailTone = document.getElementById('emailTone').value;
            
            if (!apiKey) {
                showError('Please enter your OpenAI API key');
                return;
            }
            
            if (!emailInput.trim()) {
                showError('Please enter your email ideas or draft');
                return;
            }
            
            showLoading(true);
            hideMessages();
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'system',
                                content: `You are a professional email writing assistant. Generate a well-structured, ${emailTone} email based on the user's input. Include appropriate subject line, greeting, body, and closing. Make it concise but complete.`
                            },
                            {
                                role: 'user',
                                content: `Please write a ${emailTone} email based on these ideas: ${emailInput}`
                            }
                        ],
                        max_tokens: 500,
                        temperature: 0.7
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                generatedEmailContent = data.choices[0].message.content;
                
                document.getElementById('generatedContent').innerHTML = generatedEmailContent.replace(/\n/g, '<br>');
                document.getElementById('preview').style.display = 'block';
                showSuccess('Email generated successfully!');
                
            } catch (error) {
                console.error('Error generating email:', error);
                showError('Failed to generate email. Please check your API key and try again.');
            } finally {
                showLoading(false);
            }
        }
        
        function insertToEmail() {
            if (!generatedEmailContent) {
                showError('No email content to insert');
                return;
            }
            
            Office.context.mailbox.item.body.setAsync(
                generatedEmailContent,
                { coercionType: Office.CoercionType.Text },
                function (result) {
                    if (result.status === Office.AsyncResultStatus.Succeeded) {
                        showSuccess('Email content inserted successfully!');
                    } else {
                        showError('Failed to insert email content: ' + result.error.message);
                    }
                }
            );
        }
        
        async function copyToClipboard() {
            if (!generatedEmailContent) {
                showError('No email content to copy');
                return;
            }
            
            try {
                await navigator.clipboard.writeText(generatedEmailContent);
                showSuccess('Email content copied to clipboard!');
            } catch (error) {
                showError('Failed to copy to clipboard');
            }
        }
        
        function clearAll() {
            document.getElementById('emailInput').value = '';
            document.getElementById('generatedContent').innerHTML = '';
            document.getElementById('preview').style.display = 'none';
            generatedEmailContent = '';
            hideMessages();
        }
        
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }
        
        function showSuccess(message) {
            const successDiv = document.getElementById('success');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
        }
        
        function hideMessages() {
            document.getElementById('error').style.display = 'none';
            document.getElementById('success').style.display = 'none';
        }
    </script>
</body>
</html>